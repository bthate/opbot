#!/usr/bin/python3
# OPBOT - operbot (bin/opcmd)
#
# This file is placed in the Public Domain.

import os
import sys

from op.hdl import Handler, cmd
from op.run import cfg
from op.utl import privileges

class Mini(Handler):

    def __init__(self):
        super().__init__()
        self.register("cmd", cmd)

    def direct(self, txt):
        print(txt)

def execute(main):
    try:
        main()
    except KeyboardInterrupt:
        print("")
    except PermissionError as ex:
        print(str(ex))

def main():
    try:
        import opbot
    except ImportError:
        sys.path.insert(0, os.getcwd())
        import opbot
    cfg.wd = "/var/lib/opbot/"
    privileges("opbot")
    h = Mini()
    h.load("op.cmd")
    h.walk("opbot,opmod")
    return h.cmd(" ".join(sys.argv[1:]))

# runtime

execute(main)
os._exit(0)
