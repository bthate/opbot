#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os, readline, shutil, sys

from op.bsc import Basic
from op.csl import console
from op.dbs import last
from op.obj import register
from op.run import cfg, parse_cli

def cp(event):
    if not os.path.exists(cfg.md):
        os.mkdir(cfg.md)
    fns = []
    mpath = os.path.abspath(os.path.join(os.getcwd(), "mod"))
    for fn in os.listdir(mpath):
        if not fn.endswith("py"):
            continue
        fns.append("mod/%s" % fn)
    for fn in fns:
        fnn = os.path.join(cfg.wd, fn)
        shutil.copy2(fn, fnn)
    event.reply("ok")

def main():
    cfg.wd = "/var/lib/opbot/"
    cfg.md = os.path.join(cfg.wd, "mod")
    parse_cli()
    h = Basic()
    register(h.cmds, "cp", cp)
    h.walk("mod")
    h.fromdir(cfg.md)
    return h.cmd(" ".join(sys.argv[1:]))

if __name__ == "__main__":
    console(main)
