#!/usr/bin/python3
# OPBOT - operbot (bin/opcmd)
#
# this file is placed in the public domain

import os
import sys

from op.hdl import Handler, cmd
from op.run import cfg
from op.trm import termsave, termreset

def console(main):
    termsave()
    try:
        main()
    except KeyboardInterrupt:
        print("")
    except PermissionError as ex:
        print(str(ex))
    finally:
        termreset()

class Mini(Handler):

    def __init__(self):
        super().__init__()
        self.register("cmd", cmd)

    def direct(self, txt):
        print(txt)

def main():
    cfg.wd = os.path.expanduser("~/.opbot")
    h = Mini()
    h.load("op.cmd")
    h.walk("opmod,opbot")
    return h.cmd(" ".join(sys.argv[1:]))

console(main)
os._exit(0)
