#!/usr/bin/env python3
# OPLIB- Object Programming Library (bin/test)
#
# This file is placed in the Public Domain.

import os, sys ; sys.path.insert(0, os.getcwd())
import importlib
importlib.invalidate_caches()

import sysconfig
import threading
import time
import unittest
import _thread

from op.run import cfg
from op.prs import parse_cli
from op.utl import get_exception

test_path = os.getcwd() + os.sep + "test"

def open(txt):
    try:
        for line in os.popen(txt).readlines():
            print(line.rstrip())
    except:
        pass

def execute(main):
    try:
        main()
    except KeyboardInterrupt:
        print("")
    except PermissionError as ex:
        print(str(ex))
    except Exception as ex:
        print(get_exception())

def main():
    open("rm -fR ~/.test")
    parse_cli(os.path.expanduser("~/.test"))
    if cfg.txt:
        pat = "test_%s*" % cfg.txt
    else:
        pat = "test*"
    suite = unittest.loader.TestLoader().discover(test_path, pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)

execute(main)
os._exit(0)
