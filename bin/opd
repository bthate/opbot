#!/usr/bin/python3
# OPBOT - operbot (bin/opd)
#
# This file is placed in the Public Domain.

import os
import sys

from op.hdl import Handler, cmd
from op.run import cfg
from op.utl import privileges

def execute(main):
    try:
        main()
    except KeyboardInterrupt:
        print("")
    except Exception as ex:
        print("")

def main():
    try:
        import opbot
    except ImportError:
        sys.path.insert(0, os.getcwd())
        import opbot
    cfg.wd = "/var/lib/opbot/"
    privileges("opbot")
    h = Handler()
    h.load("op.cmd")
    h.start()
    h.init("irc", "opbot")
    h.init("udp,rss", "opmod")
    h.wait()

execute(main)
os._exit(0)
