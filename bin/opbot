#!/usr/bin/env python3
# This file is placed in the Public Domain.

"""OPBOT(1)			   User Commands 		        OPBOT(1)

NAME
        OPBOT - using the law to admininster poison equals genocide.

SYNOPSIS
        opbot <cmd> [mods=mod1,mod2] [-c] [-h] -[l] [-r] [-v] [-w]
        opctl <cmd> 
        op <cmd>
        
DESCRIPTION
        OPBOT is a pure python3 IRC chat bot that can run as a background daemon
        for 24/7 a day presence in a IRC channel. You can use it to display RSS
        feeds, program your own commands for  it, have it log objects on disk and
        search. 

        If you want to run the bot 24/7 you can install OPBOT as a service for
        the systemd daemon. You can do this by copying the following into
        the /etc/systemd/system/opbot.service file, enable it and call restart:

        $ sudo cp opbot.service /etc/systemd/system
        $ sudo systemctl enable opbot
        $ sudo systemctl daemon-reload
        $ sudo systemctl start opbot

        default channel/server to join is #opbot on localhost.

        OPBOT is placed in the Public Domain, no COPYRIGHT, no LICENSE.

EXAMPLES
        1) opbot cfg server=<server> channel=<channel> nick=<nick>
        2) opbot met <userhost>
        3) opbot rss <url>
        4) opbot ftc
        5) opbot cmd
        6) opbot mods=irc

OPTIONS
        -c		start console
        -l		load config
        -r		use /var/lib/opbot/
        -s              save config
        -v              be verbose
        -w		wait 
"""

import os, readline, shutil, sys

from op.bsc import Basic
from op.dbs import last
from op.obj import Object, format, load, register, save, update
from op.prs import parse
from op.run import console, cfg, parse_cli
from op.thr import launch
from op.utl import privileges

cfg.wd = os.path.expanduser("~/.opbot")
cfg.md = os.path.join(cfg.wd, "mod")

def main():
    parse_cli()
    if cfg.op("h"):
        return print(__doc__)
    if cfg.op("s"):
        save(cfg)
    if cfg.op("l"):
        last(cfg)
    if cfg.op("r"):
        cfg.wd = "/var/lib/opbot/"
        cfg.md = "/var/lib/opbot/mod/"
        privileges("opbot")
    h = Basic()
    h.pkgs = ["opbot", "opmod"]
    h.fromdir(cfg.md)
    h.load("cmd")
    if cfg.txt:
        return h.cmd(cfg.otxt)
    if cfg.op("c"):
        h.load("fnd")
        h.load("sys")
        h.init("csl")
    if cfg.op("i"):
        h.load("ent")
        h.init("irc")
    h.start()
    h.init(cfg.mods)
    if cfg.op("cw"):
        h.wait()

console(main)
